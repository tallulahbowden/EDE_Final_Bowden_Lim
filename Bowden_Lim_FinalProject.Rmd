---
title: "2013 Black Forest Fire (Colorado) burn severity impact on soil physical and soil hydraulic properties."
author: "Evan Lim and Tallulah Bowden"
output: pdf_document
editor_options: 
  chunk_output_type: console
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE, message=F, warning=F}
# Set your working directory
getwd()

# Load your packages
library(here)
library(tidyverse)
library(lubridate)
library(agricolae)
library(car)

# Set your ggplot theme

tb_el_theme <- theme_classic(base_size = 14) +
  theme(
    axis.title = element_text(color = "darkblue"),
    panel.background = element_rect(fill = "gray"),
    legend.position = "top")

theme_set(tb_el_theme)

# Load your datasets

#hydraulic properties (kfs and sorptivity)
soil_hp_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2013.csv"), 
  stringsAsFactors = TRUE)
soil_hp_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2015.csv"), 
  stringsAsFactors = TRUE)
soil_hp_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2017.csv"), 
  stringsAsFactors = TRUE)

#particle size/soil texture
soil_ps_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2013.csv"), 
  stringsAsFactors = TRUE)
soil_ps_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2015.csv"), 
  stringsAsFactors = TRUE)
soil_ps_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2017.csv"), 
  stringsAsFactors = TRUE)

#bulk density
soil_bd_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2013_N10.csv"), 
  stringsAsFactors = TRUE)
soil_bd_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2015.csv"), 
  stringsAsFactors = TRUE)
soil_bd_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2017.csv"), 
  stringsAsFactors = TRUE)
```


# Rationale and Research Questions

Wildfires are becoming more severe, and climate change is creating warmer and
drier conditions in many places around the globe, making them more wildfire 
prone. Depending on their severity, wildfire can have significant and negative 
impacts on physical properties of soil, which directly relates to how much water 
an area can hold. 

The 2013 Black Forest Fire in Colorado's El Paso County covered 14,280 acres
and destroyed 489 homes. It is one of the most destructive forest fires in the
state's history. Following the fire, researchers collected soil data at various
sites with varying burn severity. 

We seek to better understand how the wildfire and its different intensities
impacted the soil's physical characteristics. 

\newpage

# Dataset Information

Data Source: Soil-physical and soil-hydraulic properties as a function of burn 
severity for 2013, 2015, and 2017 in the area affected by the 2013 Black Forest 
Fire, Colorado USA (ver. 2.0, June 2021)

Retrieved from: 
https://www.sciencebase.gov/catalog/item/5b8452f5e4b05f6e321b629b

Variables used: 
Soil dry bulk density, soil particle size, soil-hydraulic properties

Data range: 
2013-07-23 to 2017-06-19


\newpage

# Exploratory Analysis 

```{r hydraulic properties wrangling, message=F, warning=F}
#filter each hp dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
hp_filtered_2013 <- soil_hp_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  rename(Kfs..mm.per.hr...DL = Kfs..mm.per.hr...DL.method) %>%
  rename(Sorptivity..mm.per.sqrt.hr....DL = Sorptivity..mm.per.sqrt.hr....DL.method) %>%
  mutate(Year = "2013")

hp_filtered_2015 <- soil_hp_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  select(SampleID, 
         Site, 
         Kfs..mm.per.hr...DL, 
         Sorptivity..mm.per.sqrt.hr....DL) %>%
  na.omit() %>%
  mutate(Year = "2015")

hp_filtered_2017 <- soil_hp_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  select(SampleID, 
         Site, 
         Kfs..mm.per.hr...DL, 
         Sorptivity..mm.per.sqrt.hr....DL) %>%
  na.omit() %>%
  mutate(Year = "2017")

all_hp <- rbind(hp_filtered_2013, hp_filtered_2015, hp_filtered_2017)
all_hp_new <- all_hp[all_hp$Kfs..mm.per.hr...DL != 682.7, ]
all_hp_new <- all_hp_new %>%
  mutate(log.kfs = log10(Kfs..mm.per.hr...DL))
```

```{r particle size wrangling, warning=F, message=F}
#filter each ps dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
ps_filtered_2013 <- soil_ps_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2013")

ps_filtered_2015 <- soil_ps_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2015")

ps_filtered_2017 <- soil_ps_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2017")

all_ps <- rbind(ps_filtered_2013, ps_filtered_2015, ps_filtered_2017)

```


```{r bulk density wrangling, warning=F, message=F}
#filter each bd dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
bd_filtered_2013 <- soil_bd_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2013")

bd_filtered_2015 <- soil_bd_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2015")

bd_filtered_2017 <- soil_bd_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2017")

all_bd <- rbind(bd_filtered_2013, bd_filtered_2015, bd_filtered_2017)

```

\newpage

# Analysis

```{r hydraulic properties anova, message=F, warning=F}
#kfs
kfs.anova.2way <- aov(data = all_hp_new, 
                     log.kfs ~ Site * Year)
summary(kfs.anova.2way)
TukeyHSD(kfs.anova.2way)
kfs.interaction <- with(all_hp_new, interaction(Site, Year))
kfs.anova.2way2 <- aov(data = all_hp_new, log.kfs ~ kfs.interaction)
kfs.groups <- HSD.test(kfs.anova.2way2, "kfs.interaction", group = TRUE)
kfs.groups
kfs.anova.plot <- ggplot(all_hp_new, aes(y = log.kfs, x = Site, color = Year)) +
  geom_boxplot()
print(kfs.anova.plot)

#sorptivity
sorptivity.anova.2way <- aov(data = all_hp, 
                     Sorptivity..mm.per.sqrt.hr....DL ~ Site * Year)
summary(sorptivity.anova.2way)
TukeyHSD(sorptivity.anova.2way)

sorptivity.interaction <- with(all_hp, interaction(Site, Year))
sorptivity.anova.2way2 <- aov(data = all_hp, Sorptivity..mm.per.sqrt.hr....DL ~ sorptivity.interaction)
sorptivity.groups <- HSD.test(sorptivity.anova.2way2, "sorptivity.interaction", group = TRUE)
sorptivity.groups

sorptivity.anova.plot <- ggplot(all_hp, aes(y = Sorptivity..mm.per.sqrt.hr....DL, x = Site, color = Year)) +
  geom_boxplot()
print(sorptivity.anova.plot)

sorptivity.anova.plot.alt <- ggplot(all_hp, aes(y = Sorptivity..mm.per.sqrt.hr....DL, x = Year, color = Site)) +
  geom_boxplot()

print(sorptivity.anova.plot.alt)
```


```{r hydraulic properties assumptions, message=F, warning=F}
#normality
qqPlot(kfs.anova.2way$residuals, id = F)
qqPlot(sorptivity.anova.2way$residuals, id = F)

#homogeneity of variances
leveneTest(kfs.anova.2way)  #original value after outlier removal p = 0.02207. data was then log transformed
leveneTest(sorptivity.anova.2way)

#outliers
plot(kfs.anova.2way, which = 5) #observation 310 was an outlier. it has been removed.
plot(sorptivity.anova.2way, which = 5)

```



```{r particle size anova, message=F, warning=F}
#gravel
ps.g.anova.2way <- aov(data = all_ps, Gravel.... ~ Site * Year)
summary(ps.g.anova.2way)
TukeyHSD(ps.g.anova.2way)
ps.g.interaction <- with(all_ps, interaction(Site, Year))
ps.g.anova.2way2 <- aov(data = all_ps, Gravel.... ~ ps.g.interaction)
ps.g.groups <- HSD.test(ps.g.anova.2way2, "ps.g.interaction", group = TRUE)
ps.g.groups
ps.g.anova.plot <- ggplot(all_ps, aes(y = Gravel...., x = Site, color = Year)) +
  geom_boxplot()
print(ps.g.anova.plot)

#sand
ps.s.anova.2way <- aov(data = all_ps, Sand.... ~ Site * Year)
summary(ps.s.anova.2way)
TukeyHSD(ps.s.anova.2way)
ps.s.interaction <- with(all_ps, interaction(Site, Year))
ps.s.anova.2way2 <- aov(data = all_ps, Sand.... ~ ps.s.interaction)
ps.s.groups <- HSD.test(ps.s.anova.2way2, "ps.s.interaction", group = TRUE)
ps.s.groups
ps.s.anova.plot <- ggplot(all_ps, aes(y = Sand...., x = Site, color = Year)) +
  geom_boxplot()
print(ps.s.anova.plot)

#silt/clay
ps.sc.anova.2way <- aov(data = all_ps, Silt...Clay.... ~ Site * Year)
summary(ps.sc.anova.2way)
TukeyHSD(ps.sc.anova.2way)
ps.sc.interaction <- with(all_ps, interaction(Site, Year))
ps.sc.anova.2way2 <- aov(data = all_ps, Silt...Clay.... ~ ps.sc.interaction)
ps.sc.groups <- HSD.test(ps.sc.anova.2way2, "ps.sc.interaction", group = TRUE)
ps.sc.groups
ps.sc.anova.plot <- ggplot(all_ps, aes(y = Silt...Clay...., x = Site, color = Year)) +
  geom_boxplot()
print(ps.sc.anova.plot)
#how do we keep soil depth in account here? they seem to be random

```


```{r particle size assumptions, message=F, warning=F}
#normality
qqPlot(ps.g.anova.2way$residuals, id = F)
qqPlot(ps.s.anova.2way$residuals, id = F)
qqPlot(ps.sc.anova.2way$residuals, id = F)

#homogeneity of variances
leveneTest(ps.g.anova.2way) #p-value = 7.0882 * 10^-11. transformations did not work. using original, untrasnformed data
leveneTest(ps.s.anova.2way) #p-value = 0.0002052. transformations did not work. using original, untrasnformed data
leveneTest(ps.sc.anova.2way) #p-value = 7.027 * 10^-7. transformations did not work. using original, untrasnformed data

#outliers
plot(ps.g.anova.2way, which = 5) 
plot(ps.s.anova.2way, which = 5)
plot(ps.sc.anova.2way, which = 5)

```


```{r bulk density anova, message=F, warning=F}
#0-1 cm
bdA.anova.2way <- aov(data = all_bd, 
                     X0.1.0.cm ~ Site * Year)
summary(bdA.anova.2way)
TukeyHSD(bdA.anova.2way)
bdA.interaction <- with(all_bd, interaction(Site, Year))
bdA.anova.2way2 <- aov(data = all_bd, X0.1.0.cm ~ bdA.interaction)
bdA.groups <- HSD.test(bdA.anova.2way2, "bdA.interaction", group = TRUE)
bdA.groups
bdA.anova.plot <- ggplot(all_bd, aes(y = X0.1.0.cm, x = Site, color = Year)) +
  geom_boxplot()
print(bdA.anova.plot)

#1-3 cm
bdB.anova.2way <- aov(data = all_bd, 
                     X1.0.3.0.cm ~ Site * Year)
summary(bdB.anova.2way)
TukeyHSD(bdB.anova.2way)
bdB.interaction <- with(all_bd, interaction(Site, Year))
bdB.anova.2way2 <- aov(data = all_bd, X1.0.3.0.cm ~ bdB.interaction)
bdB.groups <- HSD.test(bdB.anova.2way2, "bdB.interaction", group = TRUE)
bdB.groups
bdB.anova.plot <- ggplot(all_bd, aes(y = X1.0.3.0.cm, x = Site, color = Year)) +
  geom_boxplot()
print(bdB.anova.plot)

#3-6 cm
bdC.anova.2way <- aov(data = all_bd, 
                     X3.0.6.0.cm ~ Site * Year)
summary(bdC.anova.2way)
TukeyHSD(bdC.anova.2way)
bdC.interaction <- with(all_bd, interaction(Site, Year))
bdC.anova.2way2 <- aov(data = all_bd, X3.0.6.0.cm ~ bdC.interaction)
bdC.groups <- HSD.test(bdC.anova.2way2, "bdC.interaction", group = TRUE)
bdC.groups
bdC.anova.plot <- ggplot(all_bd, aes(y = X3.0.6.0.cm, x = Site, color = Year)) +
  geom_boxplot()
print(bdC.anova.plot)

```


```{r bulk density assumptions, message=F, warning=F}
#normality
qqPlot(bdA.anova.2way$residuals, id = F)
qqPlot(bdB.anova.2way$residuals, id = F)
qqPlot(bdC.anova.2way, id = F)

#homogeneity of variances
leveneTest(bdA.anova.2way)
leveneTest(bdB.anova.2way)
leveneTest(bdC.anova.2way)

#outliers
plot(bdA.anova.2way, which = 5)
plot(bdB.anova.2way, which = 5)
plot(bdC.anova.2way, which = 5)

```


## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
