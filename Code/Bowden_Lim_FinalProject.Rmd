---
title: 2013 Black Forest Fire (Colorado) burn severity impact on soil physical and
  soil hydraulic properties.
author: "Evan Lim and Tallulah Bowden"
output:
  pdf_document: default
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE, message=F, warning=F}
# Set your working directory
getwd()

# Load your packages
library(here)
library(tidyverse)
library(lubridate)
library(agricolae)
library(car)

# Set your ggplot theme

tb_el_theme <- theme_classic(base_size = 14) +
  theme(
    axis.title = element_text(color = "darkblue"),
    panel.background = element_rect(fill = "gray"),
    legend.position = "top")

theme_set(tb_el_theme)

# Load your datasets

#hydraulic properties (kfs and sorptivity)
soil_hp_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2013.csv"), 
  stringsAsFactors = TRUE)
soil_hp_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2015.csv"), 
  stringsAsFactors = TRUE)
soil_hp_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Hydraulic_Properties/SHPs2017.csv"), 
  stringsAsFactors = TRUE)

#particle size/soil texture
soil_ps_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2013.csv"), 
  stringsAsFactors = TRUE)
soil_ps_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2015.csv"), 
  stringsAsFactors = TRUE)
soil_ps_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Particle_Size/psaBF2017.csv"), 
  stringsAsFactors = TRUE)

#bulk density
soil_bd_2013_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2013_N10.csv"), 
  stringsAsFactors = TRUE)
soil_bd_2015_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2015.csv"), 
  stringsAsFactors = TRUE)
soil_bd_2017_raw <- read.csv(
  here("./Data/Raw/Soil_Bulk_Density/bulkdensity2017.csv"), 
  stringsAsFactors = TRUE)
```


# 1. Rationale and Research Questions

Wildfires are becoming more severe, and climate change is creating warmer and
drier conditions in many places around the globe, making them more wildfire 
prone. Depending on their severity, wildfire can have significant and negative 
impacts on physical properties of soil, which directly relates to how much water 
an area can hold. 

The 2013 Black Forest Fire in Colorado's El Paso County covered 14,280 acres
and destroyed 489 homes. It is one of the most destructive forest fires in the
state's history. Following the fire, researchers collected soil data at various
sites with varying burn severity. 

We seek to better understand how the wildfire and its different intensities
impacted the soil's physical characteristics. 

\newpage

# 2. Dataset Information

Table: Dataset information

| Item | Value |
|:-------|:------|
| Data Source | Soil-physical and soil-hydraulic properties as a function of burn severity for 2013, 2015, and 2017 in the area affected by the 2013 Black Forest Fire, Colorado USA (ver. 2.0, June 2021) | 
| Date range | 2013-07-23 to 2017-06-19 |
| Source | Retrieved from: https://www.sciencebase.gov/catalog/item/5b8452f5e4b05f6e321b629b | 
| Variables used | Soil field-saturated hydraulic conductivity (KFS) (mm/hr), soil sorptivity (mm/sqrt[hr]), soil particle size distribution (gravel, sand, silt+clay) (%), and soil dry bulk density (grams/[cm]^3) |

\newpage

# 3. Exploration of raw data

```{r hydraulic properties data exploration, message=F, warning=F}
#structure of 2013 raw dataset
str(soil_hp_2013_raw)

#structure of 2015 raw dataset
str(soil_hp_2015_raw)

#structure of 2017 raw dataset
str(soil_hp_2017_raw)

#column names of 2013 raw dataset
colnames(soil_hp_2013_raw)

#column names of 2015 raw dataset
colnames(soil_hp_2015_raw)

#column names of 2017 raw dataset
colnames(soil_hp_2017_raw)

#summary 2013 raw dataset
summary(soil_hp_2013_raw)

#summary of 2015 raw dataset
summary(soil_hp_2015_raw)

#summary of 2017 raw dataset
summary(soil_hp_2017_raw)

```

Our 2013 raw dataframe has four variables, two related to site location and two related to hydraulic property measurements. Our 2015 raw dataframe has eight variables. Two are related to site location and six are related to hydraulic property measurements. Our 2017 raw dataframe has nine variables. The first eight are the same as the 2015 raw dataframe and the last variable is an empty column. Both KFS and sorptivity are measured with two different methods and then averaged. Methods used to measure KFS and sorptivity are the differentiated linearization method (DL) and cumulative linearization method (CL). The 2013 dataframe only uses the DL method and so this method should be chosen for all datasets. 

Our 2013 raw dataframe has no missing data. The 2015 raw dataframe has 38 missing values. The 2017 raw dataframe has 70 missing values. These missing values should be discarded before calculating descriptive statistics and conducting relavant tests.

The site location column in each dataframe (TALK ABOUT BURN SEVERITY AND YEAR LEADING US TO DO TWO WAY ANOVA. FACTORS AND CONTINUOUS DEPENDENT VARIABLE). HOW DOES THIS INFLUENCE OUR HYPOTHESIS?

\newpage

# 4. Data wrangling 

```{r hydraulic properties wrangling, message=F, warning=F}
#filter each hp dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
hp_filtered_2013 <- soil_hp_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  rename(Kfs..mm.per.hr...DL = Kfs..mm.per.hr...DL.method) %>%
  rename(Sorptivity..mm.per.sqrt.hr....DL = Sorptivity..mm.per.sqrt.hr....DL.method) %>%
  mutate(Year = "2013")

hp_filtered_2015 <- soil_hp_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  select(SampleID, 
         Site, 
         Kfs..mm.per.hr...DL, 
         Sorptivity..mm.per.sqrt.hr....DL) %>%
  na.omit() %>%
  mutate(Year = "2015")

hp_filtered_2017 <- soil_hp_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  select(SampleID, 
         Site, 
         Kfs..mm.per.hr...DL, 
         Sorptivity..mm.per.sqrt.hr....DL) %>%
  na.omit() %>%
  mutate(Year = "2017")

all_hp <- rbind(hp_filtered_2013, hp_filtered_2015, hp_filtered_2017)
all_hp_new <- all_hp[all_hp$Kfs..mm.per.hr...DL != 682.7, ]
all_hp_new <- all_hp_new %>%
  mutate(log.kfs = log10(Kfs..mm.per.hr...DL))
```

```{r particle size wrangling, warning=F, message=F}
#filter each ps dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
ps_filtered_2013 <- soil_ps_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2013")

ps_filtered_2015 <- soil_ps_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2015")

ps_filtered_2017 <- soil_ps_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2017")

all_ps <- rbind(ps_filtered_2013, ps_filtered_2015, ps_filtered_2017)

```


```{r bulk density wrangling, warning=F, message=F}
#filter each bd dataset for BF1 (high severity), BF3 (moderate severity), and 
#BF5 (low severity)
bd_filtered_2013 <- soil_bd_2013_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2013")

bd_filtered_2015 <- soil_bd_2015_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2015")

bd_filtered_2017 <- soil_bd_2017_raw %>%
  filter(Site == "BF1" | Site == "BF3" | Site == "BF5") %>%
  mutate(Year = "2017")

all_bd <- rbind(bd_filtered_2013, bd_filtered_2015, bd_filtered_2017)

```

\newpage

# 5. Analysis
## 5.1 Question 1: Does wildfire severity influence soil hydraulic properties and recovery over time?

Hsubscript~0~: There is no significant difference in soil hydraulic properties across sites or over time

Hsubscript~A~: There is a significant difference in soil hydraulic properties across sites and over time

### 5.1.1 Model: two-way ANOVA for hydraulic properties

```{r hydraulic properties anova, message=F, warning=F, echo=F}
#kfs
kfs.anova.2way <- aov(data = all_hp_new, 
                     log.kfs ~ Site * Year)
summary(kfs.anova.2way)
TukeyHSD(kfs.anova.2way)
```

With a p-value of less than 0.05, we reject the null hypothesis and conclude site does lead to significant differences in kfs values. 

```{r include=F}
# in separate code chunk as we will exclude code/outputs
kfs.interaction <- with(all_hp_new, interaction(Site, Year))
kfs.anova.2way2 <- aov(data = all_hp_new, log.kfs ~ kfs.interaction)
kfs.groups <- HSD.test(kfs.anova.2way2, "kfs.interaction", group = TRUE)
kfs.groups
kfs.anova.plot <- ggplot(all_hp_new, aes(y = log.kfs, x = Site, color = Year)) +
  geom_boxplot()
```

```{r}
#sorptivity
sorptivity.anova.2way <- aov(data = all_hp, 
                     Sorptivity..mm.per.sqrt.hr....DL ~ Site * Year)
summary(sorptivity.anova.2way)
TukeyHSD(sorptivity.anova.2way)
```

With p-values greater than 0.05,  accept the null hypothesis and conclude sorptivity does not differ significantly across sites or time. 

```{r include=F}
# in separate code chunk as we will exclude code/outputs
sorptivity.interaction <- with(all_hp, interaction(Site, Year))
sorptivity.anova.2way2 <- aov(data = all_hp, Sorptivity..mm.per.sqrt.hr....DL ~ sorptivity.interaction)
sorptivity.groups <- HSD.test(sorptivity.anova.2way2, "sorptivity.interaction", group = TRUE)
sorptivity.groups

sorptivity.anova.plot <- ggplot(all_hp, aes(y = Sorptivity..mm.per.sqrt.hr....DL, x = Site, color = Year)) +
  geom_boxplot()
```
### 5.1.2 Assumptions

Testing for normality and variance.
```{r hydraulic properties assumptions, message=F, warning=F}
#normality
qqPlot(kfs.anova.2way$residuals, id = F)
qqPlot(sorptivity.anova.2way$residuals, id = F)

#homogeneity of variances
leveneTest(kfs.anova.2way)  #original value after outlier removal p = 0.02207. data was then log transformed
leveneTest(sorptivity.anova.2way)

#outliers
plot(kfs.anova.2way, which = 5) #observation 310 was an outlier. it has been removed.
plot(sorptivity.anova.2way, which = 5)

```

### 5.1.3 Residuals

### 5.1.4 Kfs and sorptivity by site and year
```{r}
# plots
print(kfs.anova.plot)
print(sorptivity.anova.plot)

#sorptivity.anova.plot.alt <- ggplot(all_hp, aes(y = Sorptivity..mm.per.sqrt.hr....DL, x = Year, color = Site)) +
#  geom_boxplot()

#print(sorptivity.anova.plot.alt)
```

## 5.2 Question 2: Does wildfire severity influence particle size and recovery over time?

Hsubscript~0~: There is no significant difference in particle size across sites or over time

Hsubscript~A~: There is a significant difference in particle size across sites and over time

### 5.2.1 Model: two-way ANOVA for particle size

```{r particle size anova, message=F, warning=F}
#gravel
ps.g.anova.2way <- aov(data = all_ps, Gravel.... ~ Site * Year)
summary(ps.g.anova.2way)
TukeyHSD(ps.g.anova.2way)
ps.g.interaction <- with(all_ps, interaction(Site, Year))
ps.g.anova.2way2 <- aov(data = all_ps, Gravel.... ~ ps.g.interaction)
ps.g.groups <- HSD.test(ps.g.anova.2way2, "ps.g.interaction", group = TRUE)
ps.g.groups
ps.g.anova.plot <- ggplot(all_ps, aes(y = Gravel...., x = Site, color = Year)) +
  geom_boxplot()
```
With p-values less than 0.05 across the board, we reject the null hypothesis and conclude that particle size does vary across sites and time. 

```{r}
#sand
ps.s.anova.2way <- aov(data = all_ps, Sand.... ~ Site * Year)
summary(ps.s.anova.2way)
TukeyHSD(ps.s.anova.2way)
ps.s.interaction <- with(all_ps, interaction(Site, Year))
ps.s.anova.2way2 <- aov(data = all_ps, Sand.... ~ ps.s.interaction)
ps.s.groups <- HSD.test(ps.s.anova.2way2, "ps.s.interaction", group = TRUE)
ps.s.groups
ps.s.anova.plot <- ggplot(all_ps, aes(y = Sand...., x = Site, color = Year)) +
  geom_boxplot()

```
With p-values less than 0.05 for Site and Year, we reject the null hypothesis and conclude that particle size does vary across sites and time. The interaction effects are insignificant. 

```{r}
#silt/clay
ps.sc.anova.2way <- aov(data = all_ps, Silt...Clay.... ~ Site * Year)
summary(ps.sc.anova.2way)
TukeyHSD(ps.sc.anova.2way)
ps.sc.interaction <- with(all_ps, interaction(Site, Year))
ps.sc.anova.2way2 <- aov(data = all_ps, Silt...Clay.... ~ ps.sc.interaction)
ps.sc.groups <- HSD.test(ps.sc.anova.2way2, "ps.sc.interaction", group = TRUE)
ps.sc.groups
ps.sc.anova.plot <- ggplot(all_ps, aes(y = Silt...Clay...., x = Site, color = Year)) +
  geom_boxplot()

```
With p-values less than 0.05 across the board, we reject the null hypothesis and conclude that particle size does vary across sites and time. 

### 5.2.1 Assumptions
```{r particle size assumptions, message=F, warning=F}
#normality
qqPlot(ps.g.anova.2way$residuals, id = F)
qqPlot(ps.s.anova.2way$residuals, id = F)
qqPlot(ps.sc.anova.2way$residuals, id = F)

#homogeneity of variances
leveneTest(ps.g.anova.2way) #p-value = 7.0882 * 10^-11. transformations did not work. using original, untrasnformed data
leveneTest(ps.s.anova.2way) #p-value = 0.0002052. transformations did not work. using original, untrasnformed data
leveneTest(ps.sc.anova.2way) #p-value = 7.027 * 10^-7. transformations did not work. using original, untrasnformed data

#outliers
plot(ps.g.anova.2way, which = 5) 
plot(ps.s.anova.2way, which = 5)
plot(ps.sc.anova.2way, which = 5)

```
### 5.2.3 Residuals

### 5.2.4 Plots 

```{r}
print(ps.g.anova.plot)
print(ps.s.anova.plot)
print(ps.sc.anova.plot)
```

## 5.3 Question 3: How does wildfire severity influence bulk density and recovery over time?

Hsubscript~0~: There is no significant difference in bulk density across sites or over time

Hsubscript~A~: There is a significant difference in bulk density across sites and over time

### 5.3.1 Model: two-way ANOVA for bulk density
```{r bulk density anova, message=F, warning=F}
#0-1 cm
bdA.anova.2way <- aov(data = all_bd, 
                     X0.1.0.cm ~ Site * Year)
summary(bdA.anova.2way)
TukeyHSD(bdA.anova.2way)
bdA.interaction <- with(all_bd, interaction(Site, Year))
bdA.anova.2way2 <- aov(data = all_bd, X0.1.0.cm ~ bdA.interaction)
bdA.groups <- HSD.test(bdA.anova.2way2, "bdA.interaction", group = TRUE)
bdA.groups
bdA.anova.plot <- ggplot(all_bd, aes(y = X0.1.0.cm, x = Site, color = Year)) +
  geom_boxplot()
```
With a p-value of less than 0.05, we reject the null hypothesis and conclude that site location does significantly influence bulk density at this depth and the interaction effects between Site and Year are significant.

```{r}
#1-3 cm
bdB.anova.2way <- aov(data = all_bd, 
                     X1.0.3.0.cm ~ Site * Year)
summary(bdB.anova.2way)
TukeyHSD(bdB.anova.2way)
```
With a p-value of less than 0.05, we reject the null hypothesis and conclude that site locatioin does significantly influence bulk density at this depth. 

```{r include=F}
bdB.interaction <- with(all_bd, interaction(Site, Year))
bdB.anova.2way2 <- aov(data = all_bd, X1.0.3.0.cm ~ bdB.interaction)
bdB.groups <- HSD.test(bdB.anova.2way2, "bdB.interaction", group = TRUE)
bdB.groups
bdB.anova.plot <- ggplot(all_bd, aes(y = X1.0.3.0.cm, x = Site, color = Year)) +
  geom_boxplot()
```

```{r}
#3-6 cm
bdC.anova.2way <- aov(data = all_bd, 
                     X3.0.6.0.cm ~ Site * Year)
summary(bdC.anova.2way)
TukeyHSD(bdC.anova.2way)
```
With a p-value of less than 0.05, we reject the null hypothesis and conclude that site locatioin does significantly influence bulk density at this depth. 

```{r include=F}
bdC.interaction <- with(all_bd, interaction(Site, Year))
bdC.anova.2way2 <- aov(data = all_bd, X3.0.6.0.cm ~ bdC.interaction)
bdC.groups <- HSD.test(bdC.anova.2way2, "bdC.interaction", group = TRUE)
bdC.groups
bdC.anova.plot <- ggplot(all_bd, aes(y = X3.0.6.0.cm, x = Site, color = Year)) +
  geom_boxplot()
```

### 5.3.2 Assumptions
```{r bulk density assumptions, message=F, warning=F}
#normality
qqPlot(bdA.anova.2way$residuals, id = F)
qqPlot(bdB.anova.2way$residuals, id = F)
qqPlot(bdC.anova.2way, id = F)

#homogeneity of variances
leveneTest(bdA.anova.2way)
leveneTest(bdB.anova.2way)
leveneTest(bdC.anova.2way)

#outliers
plot(bdA.anova.2way, which = 5)
plot(bdB.anova.2way, which = 5)
plot(bdC.anova.2way, which = 5)

```
### 5.3.3 Residuals

### 5.3.4 Plots
```{r}
print(bdA.anova.plot)
print(bdB.anova.plot)
print(bdC.anova.plot)
```

\newpage

# 6. Summary and Conclusions


\newpage

# 7. References
<add references here if relevant, otherwise delete this section> 
